(this.webpackJsonpdonus=this.webpackJsonpdonus||[]).push([[0],{115:function(e,t,n){},117:function(e,t,n){},118:function(e,t,n){},119:function(e,t,n){},132:function(e,t,n){},135:function(e,t,n){},136:function(e,t,n){},138:function(e,t,n){"use strict";n.r(t);var a=n(1),c=n.n(a),s=n(14),r=n.n(s),i=(n(115),n(31)),o=n.n(i),l=n(28),u=n(37),j=n(15),d=(n(117),n(118),n(192)),b=n(180),h=n(94),f=n.n(h),m=n(67),O=n.n(m),p=n(68),x=n.n(p),v=n(80),g=n.n(v),_=(n(119),n(48)),y=n(24),N=y.a.initializeApp({apiKey:"AIzaSyBALCyH2IZFktMPiZQFDa_J1EDRSgDINHs",authDomain:"donus-chat.firebaseapp.com",projectId:"donus-chat",storageBucket:"donus-chat.appspot.com",messagingSenderId:"500052430086",appId:"1:500052430086:web:59dfa07f68483a22df2287",measurementId:"G-P3HJKJF3X9"}).firestore(),k=y.a.auth(),S=new y.a.auth.GoogleAuthProvider,w=N,C=(n(124),n(26)),I=n(4);var R=function(e){var t,n,c=e.id,s=e.name,r=Object(a.useState)(Math.random()),i=Object(j.a)(r,2),o=i[0],l=(i[1],Object(C.c)((function(e){return e.user})),Object(a.useState)("")),u=Object(j.a)(l,2),b=u[0],h=u[1];return Object(a.useEffect)((function(){c&&w.collection("rooms").doc(c).collection("messages").orderBy("timestamp","desc").onSnapshot((function(e){return h(e.docs.map((function(e){return e.data()})))}))}),[c]),Object(a.useEffect)((function(){console.info(c," => ",b)}),[b]),Object(I.jsx)(_.b,{to:"/rooms/"+c,children:Object(I.jsxs)("div",{className:"sidebarChat",children:[Object(I.jsx)(d.a,{src:"https://avatars.dicebear.com/api/bottts/".concat(o,".svg")}),Object(I.jsxs)("div",{className:"sidebarChat_info",children:[Object(I.jsx)("h2",{children:s}),Object(I.jsx)("p",{children:(n=null===(t=b[0])||void 0===t?void 0:t.message,n?((n=n.trim()).length>50&&(n=n.slice(0,30)+"..."),n):"")})]})]})})},E="SET_USER",F="SET_ROOM_LIST",L="SET_MAIN_CHAT",T=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return{type:E,payload:{newUserInfo:e}}},D=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{type:L,payload:{newMainChatInfo:e}}},M={};var A=function(){var e=Object(C.c)((function(e){return e.user})),t=Object(a.useState)([]),n=Object(j.a)(t,2),c=n[0],s=n[1],r=Object(a.useState)({}),i=Object(j.a)(r,2),h=i[0],m=i[1];Object(a.useEffect)((function(){c.map((function(e){var t=w.collection("rooms").doc(e).onSnapshot((function(n){c.includes(n.id)?(M[e]=n.data(),m(Object(l.a)({},M))):(delete M[e],t())}));return!1}))}),[c]),Object(a.useEffect)(Object(u.a)(o.a.mark((function t(){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.userRef.onSnapshot((function(e){s(e.data().chat.map((function(e){return e.id})))})),t.abrupt("return");case 2:case"end":return t.stop()}}),t)}))),[]);var p=function(){var t=Object(u.a)(o.a.mark((function t(){var n,a;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n=prompt("Please enter name for the new chat"))){t.next=15;break}if(!((n=n.replace(/^\s+|\s+$/gm,"")).length<=0||n.length>100)){t.next=6;break}return alert("Room name cannot be empty or too long!"),t.abrupt("return");case 6:return t.next=8,w.collection("rooms").add({creater:e.userRef,name:n,dateCreated:y.a.firestore.FieldValue.serverTimestamp(),type:"group_chat"});case 8:return a=t.sent,t.next=11,a.collection("members").add({memRef:e.userRef,role:"admin"});case 11:return console.log(a),t.next=14,e.userRef.update({chat:y.a.firestore.FieldValue.arrayUnion(a)});case 14:console.log("create new Room ",n," successfully!!!");case 15:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return Object(a.useEffect)((function(){console.log(h)}),[h]),Object(I.jsxs)("div",{className:"sidebar",children:[Object(I.jsxs)("div",{className:"sidebar__header",children:[Object(I.jsx)("div",{className:"sidebar__headerLeft",children:Object(I.jsx)(d.a,{src:null===e||void 0===e?void 0:e.photoURL})}),Object(I.jsxs)("div",{className:"sidebar__headerRight",children:[Object(I.jsx)(b.a,{onClick:p,children:Object(I.jsx)(g.a,{})}),Object(I.jsx)(b.a,{children:Object(I.jsx)(f.a,{})}),Object(I.jsx)(b.a,{children:Object(I.jsx)(O.a,{})})]})]}),Object(I.jsx)("div",{className:"sidebar__search",children:Object(I.jsxs)("div",{className:"sidebar__searchContainer",children:[Object(I.jsx)(x.a,{}),Object(I.jsx)("input",{type:"text",placeholder:"Search Donus"})]})}),Object(I.jsx)("div",{className:"sidebar__chats",children:c.map((function(e){return Object(I.jsx)(R,{id:e,name:h[e]?h[e].name:""},e)}))})]})},P=(n(132),n(20)),U=n(97),B=n.n(U),H=n(98),z=n.n(H),J=n(100),V=n.n(J),G=n(99),W=n.n(G),K=n(187),Y=n(186),Z=n(181),Q=n(185),X=n(189),$=n(188),q=n(141),ee=n(142),te=n(183),ne=n(184),ae=n(182),ce=n(191),se=n(95),re=n.n(se),ie=n(57);function oe(e){var t=Object(C.c)((function(e){return e.mainChat}));console.info(t);var n=window.location.origin+"/invite/"+t.id;return Object(I.jsxs)(ce.a,{className:"invite_friend_dialog",onClose:function(){return e.handleToggleDialog(e.id,!1)},"aria-labelledby":"simple-dialog-title",open:e.open,children:[Object(I.jsxs)(ae.a,{children:["Invite friends to ",t.name]}),Object(I.jsxs)(q.a,{children:[Object(I.jsx)(ie.a,{className:"dialog_title",variant:"subtitle2",gutterBottom:!0,style:{padding:"0 20px"},children:"Send this invite link to a friend"}),Object(I.jsxs)(ee.a,{autoFocus:!0,children:[Object(I.jsx)(te.a,{children:Object(I.jsx)(d.a,{children:Object(I.jsx)(re.a,{})})}),Object(I.jsx)(ne.a,{primary:n})]})]})]})}function le(){var e=c.a.useState(!1),t=Object(j.a)(e,2),n=t[0],s=t[1],r=c.a.useRef(null),i=function(e){s(!1)},o=Object(a.useState)({"notification-settings":!1,"invite-people":!1,"change-nickname":!1,members:!1,"leave-chat":!1}),u=Object(j.a)(o,2),d=u[0],h=u[1],f=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=Object(l.a)({},d);n[e]=t,h(n)};return Object(I.jsxs)(I.Fragment,{children:[Object(I.jsx)(b.a,{ref:r,"aria-controls":n?"chat-utils-btn":void 0,"aria-haspopup":"true",onClick:function(){s(!0)},className:"chat_utils_btn",children:Object(I.jsx)(O.a,{})}),Object(I.jsx)(Q.a,{className:"chat_utils_menu",open:n,anchorEl:r.current,role:void 0,transition:!0,disablePortal:!0,placement:"bottom-end",children:function(e){var t=e.TransitionProps,a=e.placement;return Object(I.jsx)(Y.a,Object(l.a)(Object(l.a)({},t),{},{style:{transformOrigin:"bottom"===a?"right top":"right bottom"},children:Object(I.jsx)(Z.a,{children:Object(I.jsx)(K.a,{onClickAway:i,children:Object(I.jsxs)($.a,{autoFocusItem:n,id:"menu-list-grow",children:[Object(I.jsx)(X.a,{onClick:function(){i(),f("notification-settings")},children:"Notification settings"}),Object(I.jsx)(X.a,{onClick:function(){i(),f("change-nickname")},children:"Change nickname"}),Object(I.jsx)(X.a,{onClick:function(){i(),f("members")},children:"Members"}),Object(I.jsx)(X.a,{onClick:function(){i(),f("invite-people")},children:"Invite people"}),Object(I.jsx)(X.a,{onClick:function(){i(),f("leave-chat")},children:"Leave chat"})]})})})}))}}),Object(I.jsx)(oe,{id:"invite-people",open:d["invite-people"],handleToggleDialog:f})]})}var ue=function(){var e=Object(a.useState)(Math.random()),t=Object(j.a)(e,2),n=t[0],c=t[1],s=Object(a.useState)(""),r=Object(j.a)(s,2),i=r[0],h=r[1],f=Object(P.f)().roomId,m=Object(a.useState)(""),O=Object(j.a)(m,2),p=O[0],v=O[1],g=Object(a.useState)([]),_=Object(j.a)(g,2),N=_[0],k=_[1],S=Object(a.useRef)(null),R=Object(a.useState)({}),E=Object(j.a)(R,2),F=E[0],L=E[1],T=Object(C.b)(),M=Object(C.c)((function(e){return e.user}));Object(a.useEffect)(Object(u.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!f){e.next=9;break}return t=w.collection("rooms").doc(f),e.next=4,t.get();case 4:if(e.sent.exists){e.next=6;break}return e.abrupt("return");case 6:t.onSnapshot((function(e){v(e.data().name),T(D(Object(l.a)(Object(l.a)({},e.data()),{},{id:e.id})))})),t.collection("messages").orderBy("timestamp","asc").onSnapshot((function(e){return k(e.docs.map((function(e){return e.data()})))})),t.collection("members").onSnapshot((function(e){var t=[];e.forEach((function(e){t.push(e.data().memRef.get())})),Promise.all(t).then((function(e){return e.map((function(e){return Object(l.a)(Object(l.a)({},e.data()),{},{id:e.id})}))})).then((function(e){for(var t={},n=0;n<e.length;++n)t[e[n].id]=e[n];L(Object(l.a)(Object(l.a)({},F),t))}))}));case 9:c(Math.random());case 10:case"end":return e.stop()}}),e)}))),[f]),Object(a.useEffect)((function(){console.info(N)}),[N]),Object(a.useEffect)((function(){S&&S.current.addEventListener("DOMNodeInserted",(function(e){var t=e.currentTarget;t.scroll({top:t.scrollHeight,behavior:"smooth"})}))}),[]);var A=function(e){if(!(e instanceof Date))return"";var t=e.getHours(),n=e.getMinutes(),a=t>=12?"PM":"AM",c=(t=(t%=12)||12)+":"+(n=n<10?"0"+n:n)+" "+a;return e.getDate()+" "+new Intl.DateTimeFormat("en",{month:"short"}).format(e)+" "+e.getFullYear()+" "+c};return Object(I.jsxs)("div",{className:"main_chat",children:[Object(I.jsxs)("div",{className:"chat__header",children:[Object(I.jsx)(d.a,{src:"https://avatars.dicebear.com/api/bottts/".concat(n,".svg")}),Object(I.jsxs)("div",{className:"chat__headerInfo",children:[Object(I.jsx)("h3",{children:p}),Object(I.jsx)("p",{children:"Last seen at ..."})]}),Object(I.jsxs)("div",{className:"chat__headerRight",children:[Object(I.jsx)(b.a,{children:Object(I.jsx)(x.a,{})}),Object(I.jsx)(b.a,{children:Object(I.jsx)(B.a,{})}),Object(I.jsx)(le,{})]})]}),Object(I.jsx)("div",{className:"chat__body",ref:S,children:N.map((function(e){var t;return Object(I.jsxs)("div",{className:"chat__message "+(e.sender.id==M.uid&&"chat__receiver"),children:[Object(I.jsx)("p",{className:"message__content",children:e.message}),Object(I.jsxs)("div",{className:"message__info",children:[Object(I.jsx)("span",{className:"message__name",children:F.hasOwnProperty(e.sender.id)?F[e.sender.id].name:""}),Object(I.jsx)("span",{className:"message__timestamp",children:A(null===(t=e.timestamp)||void 0===t?void 0:t.toDate())})]})]})}))}),Object(I.jsxs)("div",{className:"chat__footer",children:[Object(I.jsx)(b.a,{size:"small",children:Object(I.jsx)(z.a,{})}),Object(I.jsx)(b.a,{size:"small",children:Object(I.jsx)(W.a,{})}),Object(I.jsxs)("form",{onSubmit:function(e){e.preventDefault();var t=i.trim();""!=t&&(w.collection("rooms").doc(f).collection("messages").add({message:t,sender:M.userRef,timestamp:y.a.firestore.FieldValue.serverTimestamp()}),h(""))},children:[Object(I.jsx)("input",{type:"text",placeholder:"Type your message here ...",value:i,onChange:function(e){return h(e.target.value)}}),Object(I.jsx)("button",{type:"submit",children:"Send"})]}),Object(I.jsx)(b.a,{size:"small",children:Object(I.jsx)(V.a,{})})]})]})},je=n(190);n(135);var de=function(){var e=Object(P.f)().roomId,t=Math.random(),n=Object(a.useState)({}),c=Object(j.a)(n,2),s=c[0],r=c[1],i=Object(C.c)((function(e){return e.user}));return Object(a.useEffect)((function(){console.log(e),w.collection("rooms").doc(e).onSnapshot((function(e){var t=e.data();r(t)}))}),[e]),console.log(s),Object(I.jsx)(I.Fragment,{children:Object(I.jsx)("div",{className:"invite__container",children:Object(I.jsxs)("div",{className:"invite__box",children:[Object(I.jsx)("img",{className:"invite__img",src:"https://avatars.dicebear.com/api/bottts/".concat(t,".svg")}),Object(I.jsxs)("div",{className:"invite__text",children:[Object(I.jsx)("p",{children:"Welcome to"}),Object(I.jsx)("h3",{children:s.name?s.name:""})]}),Object(I.jsx)(je.a,{type:"submit",className:"accept__invite__btn",onClick:function(){i&&i.userRef?i.userRef.get().then(function(){var t=Object(u.a)(o.a.mark((function t(n){var a,c,s;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=!1,c=0;case 2:if(!(c<n.data().chat.length)){t.next=9;break}if(n.data().chat[c].id!=e){t.next=6;break}return a=!0,t.abrupt("break",9);case 6:++c,t.next=2;break;case 9:if(s=w.collection("rooms").doc(e),a){t.next=17;break}return t.next=13,s.collection("members").add({memRef:i.userRef,role:"normal"});case 13:return t.next=15,i.userRef.update({chat:y.a.firestore.FieldValue.arrayUnion(s)});case 15:t.next=18;break;case 17:alert("you have joined this room already!");case 18:window.location="/rooms/"+e;case 19:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()):alert("You should sign in first!!!")},children:"Accept invite"})]})})})};n(136);var be=function(){return Object(I.jsx)("div",{className:"login",children:Object(I.jsxs)("div",{className:"login__container",children:[Object(I.jsx)("img",{src:"https://img.icons8.com/color/452/whatsapp--v1.png"}),Object(I.jsx)("div",{className:"login__text",children:Object(I.jsx)("h1",{children:"Sign in Donus"})}),Object(I.jsx)(je.a,{type:"submit",onClick:function(){k.setPersistence(y.a.auth.Auth.Persistence.LOCAL).then((function(){return k.signInWithPopup(S)}))},children:"Sign in with Google"})]})})};var he=function(){return Object(a.useEffect)((function(){y.a.auth().signOut().then((function(){window.location="/",console.log("Sign-out successful!")})).catch((function(e){console.log(e)}))}),[]),Object(I.jsx)(I.Fragment,{children:"WTF"})};var fe=function(){var e=Object(C.c)((function(e){return e.user})),t=Object(C.b)(),n=Object(a.useState)(!0),c=Object(j.a)(n,2),s=c[0],r=c[1];return Object(a.useEffect)((function(){y.a.auth().onAuthStateChanged(function(){var e=Object(u.a)(o.a.mark((function e(n){var a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=17;break}return console.log("ok logged in"),console.log(n),a=w.collection("users").doc(n.uid),e.next=6,a.get();case 6:if(!e.sent.exists){e.next=12;break}return e.next=10,a.update({name:n.displayName,avatarUrl:n.photoURL});case 10:e.next=14;break;case 12:return e.next=14,a.set({name:n.displayName,avatarUrl:n.photoURL,chat:[]});case 14:t(T(Object(l.a)(Object(l.a)({},n),{},{userRef:a}))),e.next=19;break;case 17:console.log("not logged in yet"),t(T(null));case 19:r(!1);case 20:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}),[]),Object(I.jsx)(_.a,{children:Object(I.jsx)("div",{className:"App",children:Object(I.jsxs)(P.c,{children:[Object(I.jsx)(P.a,{path:"/invite/:roomId",children:Object(I.jsx)(de,{})}),!s&&(e?Object(I.jsxs)("div",{className:"app_body",children:[Object(I.jsx)(P.a,{path:"/app",children:"App"}),Object(I.jsxs)(P.a,{path:"/rooms/:roomId",children:[Object(I.jsx)(A,{}),Object(I.jsx)(ue,{})]}),Object(I.jsx)(P.a,{exact:!0,path:"/logout",children:Object(I.jsx)(he,{})})]}):Object(I.jsx)(P.a,{path:"*",children:Object(I.jsx)(be,{})}))]})})})},me=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,193)).then((function(t){var n=t.getCLS,a=t.getFID,c=t.getFCP,s=t.getLCP,r=t.getTTFB;n(e),a(e),c(e),s(e),r(e)}))},Oe=n(72),pe=Object(Oe.a)({user:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case E:return t.payload.newUserInfo;default:return e}},roomList:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case F:return t.payload.newRoomList;default:return e}},mainChat:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case L:return t.payload.newMainChatInfo;default:return e}}}),xe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{user:null,roomList:{},mainChat:{}};return Object(Oe.b)(pe,e)};r.a.render(Object(I.jsx)(c.a.StrictMode,{children:Object(I.jsx)(C.a,{store:xe(),children:Object(I.jsx)(fe,{})})}),document.getElementById("root")),me()}},[[138,1,2]]]);
//# sourceMappingURL=main.e6167384.chunk.js.map